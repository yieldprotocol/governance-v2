# Proposal
Configure series for Contango June 2023 instruments

# Background

Contango exchange uses fixed rate markets to synthesise expirable futures.
In order to allow for a smoother interaction, Yield holds a separate copy of some key contracts (Ladle, Cauldron, & Witch) and so they need to be updated in a similar fashion as the "public" ones

# Details

Here are the steps:

1. Deploy new Joins (no need for governance approval)
2. Initialise PoolOracle  (no need for governance approval)
3. Governance proposal
   1. Configure each new Join's permissions
   2. Add YieldSpaceMultiOracle oracle sources
   3. Add Composite oracle sources
   4. Add Composite oracle paths
   5. Add assets to the Contango cauldron
   6. Add series to the Contango cauldron
   7. Create ilks on the Contango cauldron
   8. Enable ilks for the created series 
   9. Increase debt ceiling for March instruments to $50k / 50 ETH

Script that performed said actions: https://github.com/yieldprotocol/environments-v2/blob/8fc6f736bad7fd604097bab6f6a984980a8f077b/scripts/governance/contango/arbitrum/jun23Instruments/orchestrate.ts

The contracts have been deployed to Arbitrum mainnet and the proposal sent to the multisig.

Configuration applied:

```typescript
export const ASSETS_ARBITRUM: Array<Asset> = [
  new Asset('00', 'ETH', false, 50000000, 25000, 12),
  new Asset('01', 'DAI', true, 50_000, 40, 18),
  new Asset('02', 'USDC', true, 50_000, 40, 6),
]

export const EXPIRIES: Array<Expiry> = [{ timestamp: EOJUN23, display: '2306' }]

export const SERIES_ARBITRUM: Array<Series> = ASSETS_ARBITRUM.map((asset) =>
  EXPIRIES.map((expiry) => new Series(asset, expiry))
).flat()

// Input data: baseId, quoteId, oracle name
export const compositeSources = SERIES_ARBITRUM.map(
  (series) => [series.bytes, series.asset.bytes, protocol.getOrThrow(YIELD_SPACE_MULTI_ORACLE)] as const
) // All fyTokens as collateral use the same oracle

// Input data: assetId, assetId, [intermediate assetId]
export const compositePaths = ASSETS_ARBITRUM.map((asset) =>
  SERIES_ARBITRUM.filter((series) => series.asset.code !== asset.code).map(
    (series) => [asset.bytes, series.bytes, [series.asset.bytes]] as const
  )
).flat()

/// @notice Assets that will be added to the protocol
/// @param Asset identifier (bytes6 tag)
/// @param Address for the asset
/// @param Address for the join
export const assetsToAdd = [
  SERIES_ARBITRUM.map(({ bytes: base }) => [base, fyTokens.getOrThrow(base), joins.getOrThrow(base)] as const),
].flat()

export const seriesToAdd: SeriesToAdd[] = SERIES_ARBITRUM.map(({ bytes: seriesId }) => ({
  seriesId,
  fyToken: fyTokens.getOrThrow(seriesId),
}))

// Input data: baseId, ilkId, ratio (1000000 == 100%), line, dust, dec
/// @notice Collateralisation parameters and debt limits for each new asset pair
/// @param Base asset identifier (bytes6 tag)
/// @param Collateral asset identifier (bytes6 tag)
/// @param Collateralisation ratio, with six decimals
/// @param Maximum protocol debt, decimals to be added
/// @param Minimum vault debt, decimals to be added
/// @param Decimals to add to maximum protocol debt, and minimum vault debt.
export const fyTokenDebtLimits = ASSETS_ARBITRUM.map((asset) =>
  SERIES_ARBITRUM.filter((series) => series.asset.code !== asset.code).map((series) => {
    const collateralisationRatio = asset.stable && series.asset.stable ? 1100000 : 1400000
    return [asset.bytes, series.bytes, collateralisationRatio, asset.maxDebt, asset.minDebt, asset.decimals] as const
  })
).flat()

export const auctionLineAndLimits: AuctionLineAndLimit[] = ASSETS_ARBITRUM.map((asset) =>
  SERIES_ARBITRUM.filter((series) => series.asset.code !== asset.code).map((series) => {
    const stablePair = asset.stable && series.asset.stable
    const vaultProportion = stablePair ? parseUnits('1') : parseUnits('0.5')
    const collateralisationRatio = stablePair ? 1100000 : 1400000
    const initialDiscount = 1050000
    const collateralProportion = parseUnits((initialDiscount / collateralisationRatio).toString())

    return {
      baseId: asset.bytes,
      ilkId: series.bytes,
      duration: 600,
      vaultProportion,
      collateralProportion,
      max: parseUnits((asset.maxDebt * 10).toString(), asset.decimals),
    }
  })
).flat()

// Input data: seriesId, [ilkIds]
/// @notice New asset pairs to be accepted
/// @param Base asset identifier (bytes6 tag)
/// @param Array of collateral asset identifiers (bytes6 tag array)
export const seriesIlks: Array<[string, string[]]> = SERIES_ARBITRUM.map((base) => {
  const ilks = SERIES_ARBITRUM.filter(
    (ilk) => ilk.asset.code !== base.asset.code && ilk.expiry.timestamp === base.expiry.timestamp
  )
  return [base.bytes, ilks.map(({ bytes }) => bytes)]
})

```

# Testing

The proposal approval & execution were tested on tenderly: https://dashboard.tenderly.co/Yield/contango/fork/f5e8940e-681d-4c1a-803d-a789bb6d0bfa

Proposal log

```bash
➜  environments-v2 git:(contango/juneInstruments) ✗ sh scripts/governance/contango/arbitrum/jun23Instruments/addJun23Instruments.sh
++ dirname scripts/governance/contango/arbitrum/jun23Instruments/addJun23Instruments.sh
+ export HERE=scripts/governance/contango/arbitrum/jun23Instruments
+ HERE=scripts/governance/contango/arbitrum/jun23Instruments
+ RUN='npx hardhat run --network arb_mainnet'
+ export CONF=/Users/bbonanno/Developer/projects/yield/environments-v2/scripts/governance/contango/arbitrum/jun23Instruments/contango.deployments
+ CONF=/Users/bbonanno/Developer/projects/yield/environments-v2/scripts/governance/contango/arbitrum/jun23Instruments/contango.deployments
+ npx hardhat run --network arb_mainnet scripts/governance/contango/arbitrum/jun23Instruments/../../../../../shared/deploy.ts
Deploying FYETH2306 with 0x523803c57a497c3AD0E850766c8276D4864edEA5
Smart Contracts successfully verified
  Contract 0x34b7fa94d07d709fb20c023858f553f8466a6574 verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x34b7fa94d07d709fb20c023858f553f8466a6574
FYETH2306 deployed at 0x34B7fA94d07d709fb20c023858f553f8466A6574
npx hardhat verify --network arb_mainnet 0x34B7fA94d07d709fb20c023858f553f8466A6574 0x523803c57a497c3AD0E850766c8276D4864edEA5 
FYETH2306.grantRoles(ROOT, timelock)
Deploying FYDAI2306 with 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a
Smart Contracts successfully verified
  Contract 0xff7b4d89617d8ac9698632b14127aac55895d21e verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0xff7b4d89617d8ac9698632b14127aac55895d21e
FYDAI2306 deployed at 0xfF7b4D89617D8ac9698632B14127aac55895d21e
npx hardhat verify --network arb_mainnet 0xfF7b4D89617D8ac9698632B14127aac55895d21e 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a 
FYDAI2306.grantRoles(ROOT, timelock)
Deploying FYUSDC2306 with 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc
Smart Contracts successfully verified
  Contract 0x790f475832695c4e523cd52d2c4ac393ca43037a verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x790f475832695c4e523cd52d2c4ac393ca43037a
FYUSDC2306 deployed at 0x790f475832695C4E523cd52d2C4Ac393cA43037A
npx hardhat verify --network arb_mainnet 0x790f475832695C4E523cd52d2C4Ac393cA43037A 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc 
FYUSDC2306.grantRoles(ROOT, timelock)
+ export CONF=/Users/bbonanno/Developer/projects/yield/environments-v2/scripts/governance/contango/arbitrum/jun23Instruments/contango.config
+ CONF=/Users/bbonanno/Developer/projects/yield/environments-v2/scripts/governance/contango/arbitrum/jun23Instruments/contango.config
+ npx hardhat run --network arb_mainnet scripts/governance/contango/arbitrum/jun23Instruments/orchestrate.ts
[path: ETH/FYDAI2306 -> 0x303100000000],
[path: ETH/FYUSDC2306 -> 0x303200000000],
[path: DAI/FYETH2306 -> 0x303000000000],
[path: DAI/FYUSDC2306 -> 0x303200000000],
[path: USDC/FYETH2306 -> 0x303000000000],
[path: USDC/FYDAI2306 -> 0x303100000000],
Using fyToken at 0x523803c57a497c3AD0E850766c8276D4864edEA5 for 0x0030FF00028B
Witch#setLineAndLimit(ilkId: FYDAI2306, baseId: ETH, duration: 600 seconds, vaultProportion: 0.5, collateralProportion: 0.75, max: 500.0)
Witch#setLineAndLimit(ilkId: FYUSDC2306, baseId: ETH, duration: 600 seconds, vaultProportion: 0.5, collateralProportion: 0.75, max: 500.0)
Witch#setLineAndLimit(ilkId: FYETH2306, baseId: DAI, duration: 600 seconds, vaultProportion: 0.5, collateralProportion: 0.75, max: 500000.0)
Witch#setLineAndLimit(ilkId: FYUSDC2306, baseId: DAI, duration: 600 seconds, vaultProportion: 1.0, collateralProportion: 0.9545454545454546, max: 500000.0)
Witch#setLineAndLimit(ilkId: FYETH2306, baseId: USDC, duration: 600 seconds, vaultProportion: 0.5, collateralProportion: 0.75, max: 0.0000005)
Witch#setLineAndLimit(ilkId: FYDAI2306, baseId: USDC, duration: 600 seconds, vaultProportion: 1.0, collateralProportion: 0.9545454545454546, max: 0.0000005)
Allowing witch to exit join: 0xfF7b4D89617D8ac9698632B14127aac55895d21e
Updating 0x0030FF00028B series with 0x0031FF00028B,0x0032FF00028B ilks
addIlks 0x0030FF00028B: 0x0031FF00028B,0x0032FF00028B
Updating 0x0031FF00028B series with 0x0030FF00028B,0x0032FF00028B ilks
addIlks 0x0031FF00028B: 0x0030FF00028B,0x0032FF00028B
Updating 0x0032FF00028B series with 0x0030FF00028B,0x0031FF00028B ilks
addIlks 0x0032FF00028B: 0x0030FF00028B,0x0031FF00028B
YieldSpaceMultiOracle: pair: FYETH2306/ETH set to Pool: 0x2769ABE33010c710e24eA6aF8A2683C630BbD7D0
CompositeMultiOracle: pair: FYETH2306/ETH set to 0xb958bA862D70C0a4bD0ea976f9a1907686dd41e2
Using pool at 0x2769ABE33010c710e24eA6aF8A2683C630BbD7D0 for 0x0030FF00028B
Adding 0x0030FF00028B for 0x303000000000 using 0x523803c57a497c3AD0E850766c8276D4864edEA5
Adding 0x0030FF00028B pool to Ladle using 0x2769ABE33010c710e24eA6aF8A2683C630BbD7D0
fyToken.grantRoles(mint/burn, ladle)
Using asset at 0x523803c57a497c3AD0E850766c8276D4864edEA5 for FYETH2306
Smart Contracts successfully verified
  Contract 0x34b7fa94d07d709fb20c023858f553f8466a6574 verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x34b7fa94d07d709fb20c023858f553f8466a6574
CompositeMultiOracle: pair: FYDAI2306/DAI set to 0xb958bA862D70C0a4bD0ea976f9a1907686dd41e2
YieldSpaceMultiOracle: pair: FYDAI2306/DAI set to Pool: 0x02DbfAca22DF7e86897aDF65eb74188D79DAbeA6
CompositeMultiOracle: pair: FYUSDC2306/USDC set to 0xb958bA862D70C0a4bD0ea976f9a1907686dd41e2
cloak.plan(witch, exit(FYDAI2306)): 0xd9a308210518a29f49de6f53874f92c6e80bd6cf0ec6d918f4eca06567ab9972
Allowing witch to exit join: 0x790f475832695C4E523cd52d2C4Ac393cA43037A
YieldSpaceMultiOracle: pair: FYUSDC2306/USDC set to Pool: 0x536edc2a3dB3BFE558Cae74cEDCcD30F07F7121b
join.revokeRole(ROOT, deployer)
cloak.plan(ladle, fyToken(FYETH2306)): 0x48975e101b45eb7dc6ce38ce6c65ad2e16afe01aa567b9cd0c20ebdd6693e3ba
join.grantRole(ROOT, cloak)
Smart Contracts successfully verified
  Contract 0x34b7fa94d07d709fb20c023858f553f8466a6574 verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x34b7fa94d07d709fb20c023858f553f8466a6574
Using join at 0x34B7fA94d07d709fb20c023858f553f8466A6574 for FYETH2306
cloak.plan(witch, exit(FYUSDC2306)): 0x6649e4bbc091ddafaaedb865e4de5f6e2b3f92c5e1dbd55f0c0cd2f3932b8fc3
Allowing witch to exit join: 0x34B7fA94d07d709fb20c023858f553f8466A6574
Adding asset FYETH2306 at 0x523803c57a497c3AD0E850766c8276D4864edEA5 with join 0x34B7fA94d07d709fb20c023858f553f8466A6574
Smart Contracts successfully verified
  Contract 0xff7b4d89617d8ac9698632b14127aac55895d21e verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0xff7b4d89617d8ac9698632b14127aac55895d21e
cloak.plan(witch, burn(FYETH2306)): 0x76a4c6f5c3ce8a2de981eb3b4b0d71eb13f5b108cf8f7d3b71ee6c29f2e2495f
Using fyToken at 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a for 0x0031FF00028B
Using pool at 0x02DbfAca22DF7e86897aDF65eb74188D79DAbeA6 for 0x0031FF00028B
Adding 0x0031FF00028B for 0x303100000000 using 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a
Adding 0x0031FF00028B pool to Ladle using 0x02DbfAca22DF7e86897aDF65eb74188D79DAbeA6
fyToken.grantRoles(mint/burn, ladle)
cloak.plan(witch, exit(FYETH2306)): 0xc62b06c390f9b6710ca2dcbe76368e78ececf4881605eacd49f4a95785e35024
Setting spot oracle for ETH/FYDAI2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.4
Setting debt limits for ETH/FYDAI2306 maxDebt: 50000000, minDebt: 25000, decimals: 12
Setting spot oracle for ETH/FYUSDC2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.4
Setting debt limits for ETH/FYUSDC2306 maxDebt: 50000000, minDebt: 25000, decimals: 12
Setting spot oracle for DAI/FYETH2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.4
Setting debt limits for DAI/FYETH2306 maxDebt: 50000, minDebt: 40, decimals: 18
Setting spot oracle for DAI/FYUSDC2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.1
Setting debt limits for DAI/FYUSDC2306 maxDebt: 50000, minDebt: 40, decimals: 18
Setting spot oracle for USDC/FYETH2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.4
Setting debt limits for USDC/FYETH2306 maxDebt: 50000, minDebt: 40, decimals: 6
Setting spot oracle for USDC/FYDAI2306 to address: 0x750B3a18115fe090Bc621F9E4B90bd442bcd02F2, ratio: 1.1
Setting debt limits for USDC/FYDAI2306 maxDebt: 50000, minDebt: 40, decimals: 6
join.revokeRole(ROOT, deployer)
cloak.plan(join, join(FYETH2306)): 0x1232a80a3c95ce941dd56decfe7df81fb01a1186934470b3f7049d75d5e5d353
join.grantRole(ROOT, cloak)
Using asset at 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a for FYDAI2306
cloak.plan(ladle, fyToken(FYDAI2306)): 0x1be72ed98371ad26f8e7ed4204e4135dc247e720a0d724ec802630fe000ae45c
Smart Contracts successfully verified
  Contract 0x790f475832695c4e523cd52d2c4ac393ca43037a verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x790f475832695c4e523cd52d2c4ac393ca43037a
Smart Contracts successfully verified
  Contract 0xff7b4d89617d8ac9698632b14127aac55895d21e verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0xff7b4d89617d8ac9698632b14127aac55895d21e
Using join at 0xfF7b4D89617D8ac9698632B14127aac55895d21e for FYDAI2306
cloak.plan(witch, burn(FYDAI2306)): 0xf4628cf9c4db6eb72e6a98bf67ea854673b98bb78342da3df2517be76b5283ab
Using fyToken at 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc for 0x0032FF00028B
join.revokeRole(ROOT, deployer)
Adding asset FYDAI2306 at 0x60a6A7fabe11ff36cbE917a17666848f0FF3A60a with join 0xfF7b4D89617D8ac9698632B14127aac55895d21e
join.grantRole(ROOT, cloak)
Using pool at 0x536edc2a3dB3BFE558Cae74cEDCcD30F07F7121b for 0x0032FF00028B
Adding 0x0032FF00028B for 0x303200000000 using 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc
Adding 0x0032FF00028B pool to Ladle using 0x536edc2a3dB3BFE558Cae74cEDCcD30F07F7121b
fyToken.grantRoles(mint/burn, ladle)
cloak.plan(join, join(FYDAI2306)): 0x1cdaf62b7645170d3fbc437717e183d77417a1062f062f85a539ffa9706d204a
cloak.plan(ladle, fyToken(FYUSDC2306)): 0xf3fa552b523632e17a020a4208a200bf612b8c28694c37cce0f5132fe73eb312
Using asset at 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc for FYUSDC2306
cloak.plan(witch, burn(FYUSDC2306)): 0x2706cac795d3c6e0a26993df21f0c16fb58c362f4d51bed0f94d2429f9742fa2
Smart Contracts successfully verified
  Contract 0x790f475832695c4e523cd52d2c4ac393ca43037a verified. You can view the contract at https://dashboard.tenderly.co/contract/arbitrum/0x790f475832695c4e523cd52d2c4ac393ca43037a
Using join at 0x790f475832695C4E523cd52d2C4Ac393cA43037A for FYUSDC2306
Adding asset FYUSDC2306 at 0xCbB7Eba13F9E1d97B2138F588f5CA2F5167F06cc with join 0x790f475832695C4E523cd52d2C4Ac393cA43037A
cloak.plan(join, join(FYUSDC2306)): 0x3691fc850f00084246b4f1b6ae6da49566c795b258dbe4a970dc8d6d80690877
DAI/FYUSDC2303: 10000 -> 50000
DAI/FYETH2303: 10000 -> 50000
USDC/FYDAI2303: 10000 -> 50000
USDC/FYETH2303: 10000 -> 50000
ETH/FYUSDC2303: 10000000 -> 50000000
ETH/FYDAI2303: 10000000 -> 50000000
Proposal: 0xe452d5c42d91eca074eb6e6a6117d15e9ce5188a5fb4f707591f954e56afaf87
Proposing
Developer: 0x05950b4e68f103d5aBEf20364dE219a247e59C23
Proposed 0xe452d5c42d91eca074eb6e6a6117d15e9ce5188a5fb4f707591f954e56afaf87
➜  environments-v2 git:(contango/juneInstruments) ✗ 
```