# Proposal

Add Euler eDAI, eUSD & eWETH as collaterals for borrowing DAI, USD & WETH respectively in the 22-09 series

# Background

Euler eTokens are interest-bearing ERC20 tokens which can be redeemed for their underlying assets, similar to Compound's cTokens.
More information [here](https://docs.euler.finance/getting-started/white-paper).

# Details

1. Deploy Euler eTokens Oracle (no need for governance approval)

   The [deployEulerOracle.ts](https://github.com/yieldprotocol/environments-v2/blob/feat/euler-token-collateral/scripts/governance/add/addCollateral/addEulerCollateral/deployEulerOracle.ts) script will be used, with no input.

2. Deploy Joins for eDAI, eUSD & eWETH (no need for governance approval)

   The [deployEulerJoins.ts](https://github.com/yieldprotocol/environments-v2/blob/feat/euler-token-collateral/scripts/governance/add/addCollateral/addEulerCollateral/deployEulerJoins.ts) script will be used, with no input.

3. Governance proposal

   The [addEToken.ts](https://github.com/yieldprotocol/environments-v2/blob/feat/euler-token-collateral/scripts/governance/add/addCollateral/addEulerCollateral/addEToken.ts) script will be used to do the following:

   1. Orchestrate and configure oracles
   2. Orchestrate join, add asset & making ilk

   The following input would be used:

```
/// addresses of eTokens:
///  [EWETH, '0x1b808F49ADD4b8C6b5117d9681cF7312Fcf0dC1D'],
///  [EDAI, '0xe025E3ca2bE02316033184551D4d3Aa22024D9DC'],
///  [EUSDC, '0xEb91861f8A4e1C12333F42DCE8fB0Ecdc28dA716'],



/// @notice Oracle sources to be added to ETokenMultiOracle
/// @param underlying asset id (bytes6 tag)
/// @param eToken id (bytes 6 tag)
/// @param Address of the eToken contract to use as the oracle
export const eulerSources: Array<[string, string, string]> = [
  [DAI, EDAI, assets.get(EDAI) as string],
  [USDC, EUSDC, assets.get(EUSDC) as string],
  [ETH, EWETH, assets.get(EWETH) as string],
]

/// @notice Assets for which we will have a Join
/// @param Asset identifier (bytes6 tag)
/// @param Address for the asset
export const assetsToAdd: Array<[string, string]> = [
  [EDAI, assets.get(EDAI) as string],
  [EUSDC, assets.get(EUSDC) as string],
  [EWETH, assets.get(EWETH) as string],
]

/// @notice Configure an asset as an ilk for a base using the ETokenMultiOracle
/// @param Base asset identifier (bytes6 tag)
/// @param Ilk asset identifier (bytes6 tag)
/// @param Collateralization ratio as a fixed point number with 6 decimals
/// @param Debt ceiling, modified by decimals
/// @param Minimum vault debt, modified by decimals
/// @param Decimals to append to debt ceiling and minimum vault debt.
export const debtLimits: Array<[string, string, number, number, number, number]> = [
  [DAI, EDAI, 1_100_000, 1_000_000, 5000, 18], // 110%
  [USDC, EUSDC, 1_100_000, 1_000_000, 5000, 6], // 110%
  [ETH, EWETH, 1_100_000, 1_000_000, 5000, 15], // 110%. 5000 ETH with 15 decimals => 5 ETH. 1M ETH with 15 decimals => 1000 ETH
]

/// @notice Limits to be used in an auction
/// @param ilk id (bytes6 tag)
/// @param duration of auctions in seconds
/// @param initial percentage of the collateral to be offered (fixed point with 18 decimals)
/// @param Maximum concurrently auctionable for this asset, modified by decimals
/// @param Minimum vault debt, modified by decimals
/// @param Decimals to append to auction ceiling and minimum vault debt.
export const auctionLimits: Array<[string, number, string, number, number, number]> = [
  [EDAI, 3600, '910000000000000000', 10_000_000, 5000, 18], // 91% = 1/110%
  [EUSDC, 3600, '910000000000000000', 10_000_000, 5000, 18], // 91% = 1/110%
  [EWETH, 3600, '910000000000000000', 10_000_000, 5000, 15],
]

/// @notice Ilks to accept for series
/// @param series identifier (bytes6 tag)
/// @param newly accepted ilks (array of bytes6 tag)
export const seriesIlks: Array<[string, string[]]> = [
  [FYDAI2209, [EDAI]],
  [FYUSDC2209, [EUSDC]],
  [FYETH2209, [EWETH]],
  [FYDAI2212, [EDAI]],
  [FYUSDC2212, [EUSDC]],
  [FYETH2212, [EWETH]],
]

```

# Testing

The change has been tested on a mainnet fork by posting eDAI, eUSD & eWETH, borrowing, repaying and withdrawing. [Script](https://github.com/yieldprotocol/environments-v2/blob/feat/euler-token-collateral/scripts/governance/add/addCollateral/addEulerCollateral/addEToken.test.ts).

```
➜  environments-v2 git:(feat/euler-token-collateral) ✗ npx hardhat run --network localhost scripts/governance/add/addCollateral/addEulerCollateral/addEToken.test.ts
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6c
eDAI balance before: 29576636.060048524672340074
series: 0x303130370000: 0107
debt: 1000000,5000,18,0
ratio: 1100000
borrowed: 5000000000000000000000 (5000.0)
posted: 5470875154004727919002 (5470.875154004727919002)
vault: 0x9c1595476ad79c255de40fd3
transfered 5470875154004727919002 eDAI to join at: 0x65e0fdbea905A2b72109a57C92ACB67ee2D60B35
posted and borrowed
repaid and withdrawn
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6e
eUSDC balance before: 34413097.804180881265179718
series: 0x303230370000: 0207
debt: 1000000,5000,6,0
ratio: 1100000
borrowed: 5000000000 (5000.0)
posted: 5454839718605795202332 (5454.839718605795202332)
vault: 0x81ae111635662cac6d0f471d
transfered 5454839718605795202332 eUSDC to join at: 0x68E9e0d89F96F40A98d3F42DC22430aBbF662a1A
posted and borrowed
repaid and withdrawn
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6d
eWETH balance before: 19862.024640862332883011
series: 0x303030370000: 0007
debt: 1000000,5000,15,0
ratio: 1100000
borrowed: 5000000000000000000 (5.0)
posted: 5507104269948832606 (5.507104269948832606)
vault: 0x1b329ea7286367bc527ad5a2
transfered 5507104269948832606 eWETH to join at: 0x69F402e82D549674CfAFFB7D1227164596e37618
posted and borrowed
repaid and withdrawn
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6c
eDAI balance before: 29576636.060048524672340074
series: 0x303130380000: 0108
debt: 1000000,5000,18,0
ratio: 1100000
borrowed: 5000000000000000000000 (5000.0)
posted: 5470875025328292445395 (5470.875025328292445395)
vault: 0xf79a57dee90d316b7b4aefb4
transfered 5470875025328292445395 eDAI to join at: 0x65e0fdbea905A2b72109a57C92ACB67ee2D60B35
posted and borrowed
repaid and withdrawn
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6e
eUSDC balance before: 34413097.804180881265179718
series: 0x303230380000: 0208
debt: 1000000,5000,6,0
ratio: 1100000
borrowed: 5000000000 (5000.0)
posted: 5454839690427235782825 (5454.839690427235782825)
vault: 0x39cc258fc8432607a0641acb
transfered 5454839690427235782825 eUSDC to join at: 0x68E9e0d89F96F40A98d3F42DC22430aBbF662a1A
posted and borrowed
repaid and withdrawn
Impersonated 0xb84cd93582cf94b0625c740f7ea441e33bc6fd6d
eWETH balance before: 19862.024640862332883011
series: 0x303030380000: 0008
debt: 1000000,5000,15,0
ratio: 1100000
borrowed: 5000000000000000000 (5.0)
posted: 5507104251842897030 (5.50710425184289703)
vault: 0x255e1e71ac3cc48318a4f219
transfered 5507104251842897030 eWETH to join at: 0x69F402e82D549674CfAFFB7D1227164596e37618
posted and borrowed
repaid and withdrawn
```
